# Data Model: Qdrant Cloud Integration

## Document Chunk Entity

**Description**: A segment of book content with associated metadata and embedding vector for semantic search

**Fields**:
- `id` (string): Unique identifier for the chunk (UUID)
- `content` (string): The text content of the chunk
- `source_document` (string): Name/path of the original document
- `chunk_id` (integer): Sequential identifier within the source document
- `position` (integer): Position offset in the original document
- `embedding_vector` (list[float]): Vector representation generated by Gemini model
- `metadata` (dict): Additional document metadata (author, creation date, etc.)
- `created_at` (datetime): Timestamp when the chunk was created
- `updated_at` (datetime): Timestamp when the chunk was last updated

**Validation Rules**:
- `content` must not be empty
- `embedding_vector` must have consistent dimensions (based on Gemini model output)
- `source_document` must reference a valid document in the `docs/` folder
- `chunk_id` must be unique within the source document

**Relationships**:
- Belongs to one `source_document`
- Multiple chunks can belong to the same source document

## Qdrant Collection Entity

**Description**: Container in Qdrant Cloud storing document chunks with embeddings

**Fields**:
- `name` (string): Name of the Qdrant collection
- `vector_size` (integer): Dimension of the embedding vectors
- `distance_metric` (string): Distance metric used for similarity search (cosine, euclidean, etc.)
- `chunks` (list[Document Chunk]): List of document chunks stored in the collection

**Validation Rules**:
- `vector_size` must match the Gemini model's embedding dimension
- `distance_metric` must be supported by Qdrant
- Collection name must be unique in the Qdrant Cloud instance

**Relationships**:
- Contains many `Document Chunk` entities

## Embedding Vector Entity

**Description**: Numerical representation of text content generated by the Gemini model

**Fields**:
- `vector_data` (list[float]): The actual embedding vector values
- `model_version` (string): Version of the Gemini model used
- `dimension` (integer): Number of dimensions in the vector
- `source_text_hash` (string): Hash of the original text for integrity verification

**Validation Rules**:
- `vector_data` must have consistent dimensions
- `dimension` must match the expected model output
- `source_text_hash` must correspond to the actual source text

**Relationships**:
- Associated with one `Document Chunk`
- Used by semantic search operations

## Search Query Entity

**Description**: User input converted to embedding for semantic similarity search

**Fields**:
- `query_text` (string): Original user query text
- `query_embedding` (list[float]): Embedding vector of the query
- `search_params` (dict): Parameters for the similarity search (top_k, score_threshold, etc.)
- `timestamp` (datetime): When the query was processed

**Validation Rules**:
- `query_text` must not be empty
- `query_embedding` must have consistent dimensions
- `search_params` must contain valid Qdrant search parameters

**Relationships**:
- Generates results from `Qdrant Collection`
- Associated with retrieved `Document Chunk` entities

## State Transitions

### Document Chunk States
- `CREATED`: Chunk has been created but not yet processed
- `EMBEDDED`: Embedding has been generated for the chunk
- `STORED`: Chunk has been stored in Qdrant Cloud
- `ACTIVE`: Chunk is available for search operations
- `DEPRECATED`: Chunk is no longer current (when source document is updated)

### Search Query States
- `RECEIVED`: Query has been received from user
- `EMBEDDED`: Query text has been converted to embedding
- `SEARCHED`: Similarity search has been performed
- `RESULTS_READY`: Relevant chunks have been retrieved
- `ANSWER_GENERATED`: Final response has been generated